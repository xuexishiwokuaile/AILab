{"ast":null,"code":"import \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/upload/style\";\nimport _Upload from \"antd/es/upload\";\nimport \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nvar _jsxFileName = \"/Users/chenanran/WebstormProjects/iCube-master/src/AILab/imgProcess/tagImage.js\";\nimport React from \"react\";\nimport axios from 'axios'; //import apis from '@/services/api';\n\n//定义后台返回数据类型\nlet responseData = {\n  tag: '11'\n};\nconst Option = _Select.Option;\nconst Meta = _Card.Meta;\n\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n\n    reader.onload = () => resolve(reader.result);\n\n    reader.onerror = error => reject(error);\n  });\n}\n\nclass Demo extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      previewVisible: false,\n      previewImage: '',\n      fileList: [],\n      key: '',\n      url: '',\n      imageUrl: ''\n    };\n\n    this.handleSubmit = e => {\n      e.preventDefault();\n      this.props.form.validateFields((err, values) => {\n        if (!err) {\n          console.log('Received values of form: ', values);\n        }\n\n        let data = new FormData();\n        data.append(\"upload\", values.upload);\n        let url = \"\";\n        axios.post(url, data, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        }).then(function (response) {\n          //得到后台返回的分数值\n          responseData = response.data;\n          console.log(responseData.tag);\n        }).catch(function (error) {\n          console.log(error);\n        });\n      });\n    };\n\n    this.handlePreview = async file => {\n      if (!file.url && !file.preview) {\n        file.preview = await getBase64(file.originFileObj);\n      }\n\n      this.setState({\n        previewImage: file.url || file.preview,\n        previewVisible: true\n      });\n    };\n\n    this.handleCancel = () => this.setState({\n      previewVisible: false\n    });\n\n    this.handleChange = ({\n      fileList\n    }) => this.setState({\n      fileList\n    });\n\n    this.normFile = e => {\n      console.log('Upload event:', e);\n\n      if (Array.isArray(e)) {\n        return e;\n      }\n\n      return e && e.fileList;\n    };\n\n    this.fetchUploadToken = async () => {\n      const params = {\n        quantity: 1,\n        module: 3,\n        fileType: 1\n      };\n      const res = await apis.fileSign(params);\n      const d = res.d,\n            m = res.m;\n\n      if (m === 'success') {\n        const _d$l$ = d.l[0],\n              key = _d$l$.key,\n              url = _d$l$.url;\n        this.setState({\n          key,\n          url\n        });\n        return true;\n      } else {\n        return false;\n      }\n    };\n  }\n\n  render() {\n    const _this$state = this.state,\n          previewVisible = _this$state.previewVisible,\n          previewImage = _this$state.previewImage,\n          fileList = _this$state.fileList;\n    const _this$state2 = this.state,\n          imageUrl = _this$state2.imageUrl,\n          url = _this$state2.url,\n          key = _this$state2.key;\n    const that = this;\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    const uploadButton = React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, React.createElement(_Icon, {\n      type: \"plus\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"ant-upload-text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, \"Upload\"));\n    const formItemLayout = {\n      labelCol: {\n        span: 6\n      },\n      wrapperCol: {\n        span: 14\n      }\n    };\n    const uploadProps = {\n      name: 'file',\n      showUploadList: false,\n      multiple: false,\n      accept: '.png, .jpg, .jpeg, .gif',\n      action: url,\n      beforeUpload: that.beforeUpload,\n      // 这里需要指定文件上传的content-type\n      headers: {\n        'Content-Type': 'application/octet-stream'\n      },\n\n      // 自定文件上传的方法，覆盖组件的 onChange 方法，可以定义上传不同阶段的行为（由 axios 默认提供）\n      onStart(file) {\n        console.log('onStart', file, file.name);\n      },\n\n      onSuccess(ret, file) {\n        console.log('onSuccess', ret, file);\n        that.props.getData(key);\n      },\n\n      onProgress({\n        percent\n      }, file) {\n        console.log('onProgress', \"\".concat(percent, \"%\"), file.name);\n      },\n\n      onError(err) {\n        console.log('onError', err);\n      },\n\n      customRequest({\n        action,\n        file,\n        headers,\n        onError,\n        onProgress,\n        onSuccess,\n        withCredentials\n      }) {\n        // 使用 FileReader 将上传的文件转换成二进制流，满足 'application/octet-stream' 格式的要求\n        const reader = new FileReader();\n        reader.readAsArrayBuffer(file);\n        let fileData = null;\n\n        reader.onload = e => {\n          // 在文件读取结束后执行的操作\n          fileData = e.target.result; // 使用 axios 进行文件上传的请求\n\n          axios.put(action, fileData, {\n            withCredentials,\n            headers,\n            onUploadProgress: ({\n              total,\n              loaded\n            }) => {\n              // 进行上传进度输出，更加直观\n              onProgress({\n                percent: Math.round(loaded / total * 100).toFixed(2)\n              }, file);\n            }\n          }).then(response => {\n            onSuccess(response, file);\n          }).catch(onError);\n        };\n\n        return {\n          abort() {\n            console.log('upload progress is aborted.');\n          }\n\n        };\n      }\n\n    };\n    return React.createElement(_Form, Object.assign({}, formItemLayout, {\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }), React.createElement(_Form.Item, {\n      label: \"\\u9009\\u62E9\\u56FE\\u7247\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, getFieldDecorator('upload', {\n      valuePropName: 'fileList',\n      getValueFromEvent: this.normFile\n    })(React.createElement(_Upload, Object.assign({}, uploadProps, {\n      // action=\"https://www.mocky.io/v2/5cc8019d300000980a055e76\"\n      //action=\"http://www.icube.fun:8000/image_recognize/\"\n      action: \"http://localhost:8080/oss/fileObj\",\n      listType: \"picture-card\",\n      fileList: fileList,\n      onPreview: this.handlePreview,\n      onChange: this.handleChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }), fileList.length >= 1 ? null : uploadButton)), React.createElement(_Modal, {\n      visible: previewVisible,\n      footer: null,\n      onCancel: this.handleCancel,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      alt: \"example\",\n      style: {\n        width: '100%'\n      },\n      src: previewImage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    }))), React.createElement(_Form.Item, {\n      wrapperCol: {\n        span: 12,\n        offset: 6\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    }, React.createElement(_Button, {\n      type: \"primary\",\n      htmlType: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }, \"\\u5F00\\u59CB\\uFF01\")), React.createElement(\"div\", {\n      style: {\n        background: '#ECECEC',\n        padding: '30px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, React.createElement(_Card, {\n      title: \"\\u8FD9\\u5F20\\u56FE\\u7247\\u7684\\u6807\\u7B7E\\u4E3A\",\n      bordered: false,\n      style: {\n        width: 300,\n        marginLeft: 500\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }, responseData.tag))));\n  }\n\n}\n\nconst WrappedDemo2 = _Form.create({\n  name: 'validate_other'\n})(Demo);\n\nexport default WrappedDemo2;","map":{"version":3,"sources":["/Users/chenanran/WebstormProjects/iCube-master/src/AILab/imgProcess/tagImage.js"],"names":["React","axios","responseData","tag","Option","Meta","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","Demo","Component","state","previewVisible","previewImage","fileList","key","url","imageUrl","handleSubmit","e","preventDefault","props","form","validateFields","err","values","console","log","data","FormData","append","upload","post","headers","then","response","catch","handlePreview","preview","originFileObj","setState","handleCancel","handleChange","normFile","Array","isArray","fetchUploadToken","params","quantity","module","fileType","res","apis","fileSign","d","m","l","render","that","getFieldDecorator","uploadButton","formItemLayout","labelCol","span","wrapperCol","uploadProps","name","showUploadList","multiple","accept","action","beforeUpload","onStart","onSuccess","ret","getData","onProgress","percent","onError","customRequest","withCredentials","readAsArrayBuffer","fileData","target","put","onUploadProgress","total","loaded","Math","round","toFixed","abort","valuePropName","getValueFromEvent","length","width","offset","background","padding","marginLeft","WrappedDemo2","create"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport axios from 'axios';\n//import apis from '@/services/api';\n\nimport {\n    Form,\n    Select,\n    InputNumber,\n    Switch,\n    Radio,\n    Slider,\n    Button,\n    Upload,\n    Icon,\n    Rate,\n    Checkbox,\n    Row,\n    Col,\n    Card,\n    Modal,\n} from 'antd';\n\n//定义后台返回数据类型\nlet responseData={\n    tag:'11'\n};\n\nconst { Option } = Select;\nconst { Meta } = Card;\n\nfunction getBase64(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onload = () => resolve(reader.result);\n        reader.onerror = error => reject(error);\n    });\n}\n\nclass Demo extends React.Component {\n    state = {\n        previewVisible: false,\n        previewImage: '',\n        fileList: [\n\n        ],\n        key: '',\n        url: '',\n        imageUrl: '',\n    };\n\n    //提交事件\n    //图片单独提交，submit只是为了请求后台数据\n    handleSubmit = e => {\n        e.preventDefault();\n        this.props.form.validateFields((err, values) => {\n            if (!err) {\n                console.log('Received values of form: ', values);\n            }\n            let data = new FormData();\n            data.append(\"upload\",values.upload);\n            let url = \"\";\n            axios.post(url, data,{\n                headers: {\n                    'Content-Type': 'multipart/form-data'\n                }\n            })\n                .then(function (response) {\n                    //得到后台返回的分数值\n                    responseData=response.data;\n                    console.log(responseData.tag);\n                })\n                .catch(function (error) {\n                    console.log(error);\n                });\n        });\n    };\n\n    //图片预览\n    handlePreview = async file => {\n        if (!file.url && !file.preview) {\n            file.preview = await getBase64(file.originFileObj);\n        }\n\n        this.setState({\n            previewImage: file.url || file.preview,\n            previewVisible: true,\n        });\n    };\n\n    //关闭预览框\n    handleCancel = () => this.setState({ previewVisible: false });\n\n    handleChange = ({ fileList }) => this.setState({ fileList });\n\n    normFile = e => {\n        console.log('Upload event:', e);\n        if (Array.isArray(e)) {\n            return e;\n        }\n        return e && e.fileList;\n    };\n\n    // 获取上传凭证\n    fetchUploadToken = async () => {\n        const params = {\n            quantity: 1,\n            module: 3,\n            fileType: 1,\n        };\n        const res = await apis.fileSign(params);\n        const { d, m } = res;\n        if (m === 'success') {\n            const { key, url } = d.l[0];\n            this.setState({ key, url });\n            return true;\n        } else {\n            return false;\n        }\n    };\n\n    render() {\n        const { previewVisible, previewImage, fileList } = this.state;\n        const { imageUrl, url, key } = this.state;\n        const that = this;\n        const { getFieldDecorator } = this.props.form;\n        const uploadButton = (\n            <div>\n                <Icon type=\"plus\" />\n                <div className=\"ant-upload-text\">Upload</div>\n            </div>\n        );\n        const formItemLayout = {\n            labelCol: { span: 6 },\n            wrapperCol: { span: 14 },\n        };\n\n        const uploadProps = {\n            name: 'file',\n            showUploadList: false,\n            multiple: false,\n            accept: '.png, .jpg, .jpeg, .gif',\n            action: url,\n            beforeUpload: that.beforeUpload,\n            // 这里需要指定文件上传的content-type\n            headers: {\n                'Content-Type': 'application/octet-stream',\n            },\n            // 自定文件上传的方法，覆盖组件的 onChange 方法，可以定义上传不同阶段的行为（由 axios 默认提供）\n            onStart(file) {\n                console.log('onStart', file, file.name);\n            },\n            onSuccess(ret, file) {\n                console.log('onSuccess', ret, file);\n                that.props.getData(key);\n            },\n            onProgress({ percent }, file) {\n                console.log('onProgress', `${percent}%`, file.name);\n            },\n            onError(err) {\n                console.log('onError', err);\n            },\n            customRequest({\n                              action,\n                              file,\n                              headers,\n                              onError,\n                              onProgress,\n                              onSuccess,\n                              withCredentials,\n                          }) {\n                // 使用 FileReader 将上传的文件转换成二进制流，满足 'application/octet-stream' 格式的要求\n                const reader = new FileReader();\n                reader.readAsArrayBuffer(file);\n                let fileData = null;\n                reader.onload = (e) => {\n                    // 在文件读取结束后执行的操作\n                    fileData = e.target.result;\n                    // 使用 axios 进行文件上传的请求\n                    axios.put(action, fileData, {\n                        withCredentials,\n                        headers,\n                        onUploadProgress: ({ total, loaded }) => {\n                            // 进行上传进度输出，更加直观\n                            onProgress({ percent: Math.round(loaded / total * 100).toFixed(2) }, file);\n                        },\n                    }).then(response => {\n                        onSuccess(response, file);\n                    })\n                        .catch(onError);\n                };\n                return {\n                    abort() {\n                        console.log('upload progress is aborted.');\n                    },\n                };\n            },\n        };\n\n        return (\n            <Form {...formItemLayout} onSubmit={this.handleSubmit}>\n                <Form.Item label=\"选择图片\">\n                    {\n                        getFieldDecorator('upload',{\n                            valuePropName: 'fileList',\n                            getValueFromEvent: this.normFile,\n                        })(\n                            <Upload\n                                {...uploadProps}\n                                // action=\"https://www.mocky.io/v2/5cc8019d300000980a055e76\"\n                                //action=\"http://www.icube.fun:8000/image_recognize/\"\n                                action=\"http://localhost:8080/oss/fileObj\"\n                                listType=\"picture-card\"\n                                fileList={fileList}\n                                onPreview={this.handlePreview}\n                                onChange={this.handleChange}\n                            >\n                                {fileList.length >= 1 ? null : uploadButton}\n                            </Upload>\n                        )\n                    }\n                    <Modal visible={previewVisible} footer={null} onCancel={this.handleCancel}>\n                        <img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\n                    </Modal>\n                </Form.Item>\n\n                <Form.Item wrapperCol={{ span: 12, offset: 6 }}>\n                    <Button type=\"primary\" htmlType=\"submit\">\n                        开始！\n                    </Button>\n                </Form.Item>\n                <div style={{ background: '#ECECEC', padding: '30px' }}>\n                    <Card title=\"这张图片的标签为\" bordered={false} style={{ width: 300 ,marginLeft:500}}>\n                        <p>{responseData.tag}</p>\n                    </Card>\n                </div>\n            </Form>\n        );\n    }\n}\n\nconst WrappedDemo2 = Form.create({ name: 'validate_other' })(Demo);\nexport default WrappedDemo2;"]},"metadata":{},"sourceType":"module"}